- name: Install zsh
  community.general.homebrew:
    name:
      - zsh
      - vivid
      - coreutils
    state: present

- name: Install iTerm2
  community.general.homebrew_cask:
    name:
      - iterm2
      - homebrew/cask-fonts/font-hack
    state: present


- name: Create local directory
  ansible.builtin.file:
    path: ~/.dotfiles/terminal
    state: directory
    mode: '0755'

- name: Download oh-my-zsh installer
  ansible.builtin.get_url:
    url: https://raw.githubusercontent.com/ohmyzsh/ohmyzsh/master/tools/install.sh
    dest: /tmp/oh-my-zsh.sh

- name: Install oh-my-zsh
  ansible.builtin.command:
    cmd: bash /tmp/oh-my-zsh.sh
    creates: ~/.oh-my-zsh

- name: Update .zshrc
  ansible.builtin.template:
    src: zshrc.j2
    dest: ~/.zshrc
    owner: "{{ lookup('env', 'USER') }}"
    group: staff
    mode: '0644'
    backup: yes

- name: Checkout iTerm2 Theme
  ansible.builtin.git:
    repo: 'https://github.com/mbadolato/iTerm2-Color-Schemes.git'
    dest: ~/.dotfiles/terminal/iterm2-color-schemes

- name: Import theme
  ansible.builtin.command:
    cmd: ~/.dotfiles/terminal/iterm2-color-schemes/tools/import-scheme.sh 'DimmedMonokai'

- name: Save profile
  ansible.builtin.copy:
    src: "{{ ansible_env.PWD }}/roles/terminal/files/com.googlecode.iterm2.plist"
    dest: ~/Library/Preferences/com.googlecode.iterm2.plist


- name: Install zsh-completions
  ansible.builtin.git:
    repo: 'https://github.com/zsh-users/zsh-completions'
    dest: ~/.oh-my-zsh/custom/plugins/zsh-completions

- name: Create my-completions plugin
  ansible.builtin.file:
    path: ~/.oh-my-zsh/custom/plugins/my-completions
    state: directory
    mode: '0755'

- name: Create my-completions src plugin
  ansible.builtin.file:
    path: ~/.oh-my-zsh/custom/plugins/my-completions/src
    state: directory
    mode: '0755'

- name: Copy my-completions plugin
  ansible.builtin.copy:
    src: "{{ ansible_env.PWD }}/roles/terminal/files/my-completions.plugin.zsh"
    dest: ~/.oh-my-zsh/custom/plugins/my-completions/my-completions.plugin.zsh
